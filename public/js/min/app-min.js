angular.module("app",[]).service("CordovaService",["$document","$q",function(o,e){var n=e.defer(),t=!1,i=this;this.ready=n.promise,$(document).ready(function(){document.addEventListener("deviceready",function(){t=!0,n.resolve(window.cordova)})}),setTimeout(function(){t||window.cordova&&n.resolve(window.cordova)},3e3)}]).run(["$rootScope","CordovaService","$http",function(o,e,n){function t(e){o.position=e,console.log(o.position),window.position=o.position,o.geoFinished=!0,console.log(o.geoFinished),o.writeToPhone("_geoCoords",o.position.coords.latitude+"::"+o.position.coords.longitude),o.position.coords.accuracy>20?($(".dialog-geo").find("h1").text("The accuracy of your position is: "+o.position.coords.accuracy.toFixed(2)+"m. Good enough? (Turn your gps on!)"),apparitionDown($(".dialog-geo"))):console.log("<10")}o.geoFinished=!1,o.reallyTime=function(){parkCount(),o.geoFinished=!1,o.getPosition()},o.reallyTimer=function(e,n){timer(e,n),o.geoFinished=!1,o.getPosition()},o.getPosition=function(){disparitionUp($(".dialog-geo")),o.geoFinished=!1,navigator.geolocation&&navigator.geolocation.getCurrentPosition(t,null,{enableHighAccuracy:!0,timeout:5e3})},o.getPositionAgain=function(){setTimeout(o.getPosition(),3e3)},o.gmaps=function(){console.log(o.lat+" -- "+o.long),o.latlng=new google.maps.LatLng(o.lat,o.long),console.log(o.latlng);var e={zoom:14,center:o.latlng,disableDefaultUI:!0},n=new google.maps.Map(document.getElementById("map_canvas"),e);$("#map_canvas").css("height",window.innerHeight).css("width",window.innerWidth),google.maps.event.addDomListener(window,"resize",function(){$("#map_canvas").css("height",window.innerHeight).css("width",window.innerWidth)});var t=new google.maps.Marker({map:n,position:o.latlng})},$(document).on("pageshow","#map",function(e){o.gmaps(),console.log("map loaded")}),o.getDeviceName=function(){e.ready.then(function(){window.deviceName=device.platform})},o.loadLastCurrentData=function(){e.ready.then(function(){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,o.gotFSReader,o.fail)})},o.writeData=function(n){o.currentData={},o.currentData=n,e.ready.then(function(){console.log("CordovaService Ready."),window.requestFileSystem(LocalFileSystem.PERSISTENT,0,o.gotFS,o.fail)})},o.writeDatouz=function(){e.ready.then(function(){console.log("CordovaService Ready."),window.requestFileSystem(LocalFileSystem.PERSISTENT,0,o.gotFS,o.fail)})},o.gotFSReader=function(e){e.root.getFile(config.savedFile,null,o.gotFileEntryReader,o.fail)},o.gotFileEntryReader=function(e){e.file(o.gotFile,o.fail)},o.gotFile=function(e){o.readData(e)},o.readData=function(e,n){var t=new FileReader;t.onloadend=function(e){console.log("Entered Read."),o.$apply(function(){o.currentData={},o.currentData=JSON.parse(e.target.result),console.log(e.target.result),o.loadLast($("textarea"),o.currentData),console.log(o.currentData),window.rscd=o.currentData,o.firstLoad=!1,console.log("Read completed.")})},t.readAsText(e)},o.gotFS=function(e){e.root.getFile(config.savedFile,{create:!0,exclusive:!1},o.gotFileEntry,o.fail)},o.gotFileEntry=function(e){e.createWriter(o.gotFileWriter,o.fail)},o.gotFileWriter=function(e){e.onwriteend=function(o){},e.write(JSON.stringify(o.currentData))},o.fail=function(o){console.log(1==o.code?"Error: file not found exception":2==o.code?"Error: invalid url error":"Error: connection error")},o.jsonWriteData=function(e,n){console.log("Entered jsonWriteData");var t=JSON.stringify(o.currentData);if(console.log(o.currentData),console.log(t),"{}"===t)console.log(1),t='{"'+e+'":"'+n+'"}',o.writeData(JSON.parse(t));else if(-1==t.indexOf(e))console.log(2),i=t.slice(0,t.length-1),t=i+',"'+e+'":"'+n+'"}',console.log(t),window.tmp=t,o.writeData(JSON.parse(t));else{console.log(3);var i=t.slice(0,t.indexOf(e)+e.length+3),a=n,r=t.slice(t.indexOf(e)+e.length+3,t.length),l=r.slice(r.indexOf('"'),t.length);t=i+a+l,console.log(i),console.log(a),console.log(l),console.log(t),o.writeData(JSON.parse(t))}o.key="",o.value="",console.log("jsonWriteData finished.")},o.writeToPhone=function(e,n){console.log("Entered writeToPhone"),o.key=e,"string"==typeof n&&"."!=n.charAt(0)?(console.log(n),console.log(n.charAt(0)),o.value=n):o.value=$(n).val(),o.jsonWriteData(o.key,o.value),console.log("writeToPhone finished.")},o.loadLast=function(e,n){if(console.log("Entered loadLAst"),n._pkNotes&&e.val(n._pkNotes),n._geoCoords){var t=n._geoCoords.split("::");o.lat=parseFloat(t[0]),o.long=parseFloat(t[1])}n._activePage&&"main-screen-to-park"==$.mobile.activePage.attr("id")&&("main-screen-to-park"!=n._activePage?window.location.href="#"+n._activePage:console.log(n._activePage)),console.log("Finshed loadLAst")},o.goToCar=function(){console.log("entered go to car");var e=codeLatLng(o.lat,o.long)},$(document).on("pagechange",function(e){console.log($.mobile.activePage.attr("id")),0==o.firstLoad&&o.writeToPhone("_activePage",$.mobile.activePage.attr("id"))}),o.init=function(){var e;o.firstLoad=!0,o.angularLoaded=!0,console.log("coucou angular"),o.currentData={},o.key="",o.value="",o.lat="",o.long="",o.getDeviceName(),o.loadLastCurrentData()},o.init()}]);